<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mandelbrot Visualizer</title>
<link rel="stylesheet" href="../common.css">
</head>
<body>
<canvas id="canvas"></canvas>
<div class="controls">
  <button id="toggleSettings">Toggle Settings</button>
</div>
<div id="settings" class="settings-panel">
  <label>Max Iterations: <input type="range" id="iter" min="50" max="1000" value="200"></label>
  <label>Color Offset: <input type="range" id="colorOffset" min="0" max="360" value="0"></label>
</div>
<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
let width,height;
function resize(){
  width=canvas.width=window.innerWidth;
  height=canvas.height=window.innerHeight;
  draw();
}
window.addEventListener('resize',resize);
let maxIter=200;
let colorOffset=0;
let xmin=-2,xmax=1,ymin=-1.5,ymax=1.5;
function hsv2rgb(h,s,v){
  const f=(n,k=(n+h/60)%6)=>v-v*s*Math.max(Math.min(k,4-k,1),0);
  return [f(5)*255,f(3)*255,f(1)*255];
}
function draw(){
  const img=ctx.createImageData(width,height);
  let i=0;
  for(let y=0;y<height;y++){
    const cy=ymin+(y/height)*(ymax-ymin);
    for(let x=0;x<width;x++){
      const cx=xmin+(x/width)*(xmax-xmin);
      let zx=0,zy=0,it=0;
      while(zx*zx+zy*zy<=4 && it<maxIter){
        const xt=zx*zx-zy*zy+cx;
        zy=2*zx*zy+cy;
        zx=xt;
        it++;
      }
      const hue=it===maxIter?0:(colorOffset+(it/maxIter)*360);
      const [r,g,b]=hsv2rgb(hue,1,it===maxIter?0:1);
      img.data[i++]=r;img.data[i++]=g;img.data[i++]=b;img.data[i++]=255;
    }
  }
  ctx.putImageData(img,0,0);
}
document.getElementById('toggleSettings').onclick=()=>{
  settings.style.display=settings.style.display?"":'block';
};
iter.oninput=()=>{maxIter=parseInt(iter.value,10);draw();};
colorOffset.oninput=()=>{colorOffset=parseInt(colorOffset.value,10);draw();};
canvas.onwheel=e=>{
  e.preventDefault();
  const zoom=e.deltaY>0?1.2:0.8;
  const rect=canvas.getBoundingClientRect();
  const x=xmin+(e.clientX-rect.left)/width*(xmax-xmin);
  const y=ymin+(e.clientY-rect.top)/height*(ymax-ymin);
  const nx=(xmax-xmin)*zoom;
  const ny=(ymax-ymin)*zoom;
  xmin=x-nx*(e.clientX-rect.left)/width;
  xmax=xmin+nx;
  ymin=y-ny*(e.clientY-rect.top)/height;
  ymax=ymin+ny;
  draw();
};
resize();
</script>
</body>
</html>
