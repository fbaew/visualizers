<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Triangles Visualizer</title>
<style>
body { margin:0; overflow:hidden; background:#000; color:#fff; font-family:Arial, sans-serif; }
#controls { position:absolute; top:10px; right:10px; z-index:10; }
#settings { position:absolute; top:40px; right:10px; background:rgba(0,0,0,0.8); color:#fff; padding:10px; border:1px solid #555; display:none; }
label { display:block; margin:4px 0; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="controls">
  <button id="toggleSettings">Toggle Settings</button>
</div>
<div id="settings">
  <label>Triangles: <input type="range" id="triCount" min="1" max="20" value="5"></label>
  <label>Snap Distance: <input type="range" id="snapRange" min="20" max="150" value="60"></label>
</div>
<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
let width=canvas.width=window.innerWidth;
let height=canvas.height=window.innerHeight;
window.addEventListener('resize',()=>{ width=canvas.width=window.innerWidth; height=canvas.height=window.innerHeight; });

const colorsA=['#ff4499','#ff8844'];
const colorsB=['#44ddff','#aaffff'];

let triangles=[];
let snapDistance=60;

function rand(min,max){return Math.random()*(max-min)+min;}
function createPoint(){return {x:rand(0,width),y:rand(0,height),dx:rand(-2,2),dy:rand(-2,2)};}
function clonePoint(p){return {x:p.x,y:p.y,dx:p.dx,dy:p.dy};}
function createTriangle(superTri=false){
  return {
    points:[createPoint(),createPoint(),createPoint()],
    color:Math.random()<0.5?colorsA:colorsB,
    isSuper:superTri,
    highlight:0,
    phase:Math.random()*Math.PI*2
  };
}

function resetTriangles(count){
  triangles=[];
  for(let i=0;i<count;i++) triangles.push(createTriangle());
}

function distance(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
function midpoint(a,b){return {x:(a.x+b.x)/2,y:(a.y+b.y)/2};}

function movePoints(){
  triangles.forEach(t=>{
    t.points.forEach(p=>{
      p.x+=p.dx; p.y+=p.dy;
      if(p.x<0||p.x>width) p.dx*=-1;
      if(p.y<0||p.y>height) p.dy*=-1;
    });
  });
}

function lighten(col,amt){
  const c=parseInt(col.slice(1),16);
  let r=(c>>16)+amt; r=r>255?255:r; r=r<0?0:r;
  let g=((c>>8)&255)+amt; g=g>255?255:g; g=g<0?0:g;
  let b=(c&255)+amt; b=b>255?255:b; b=b<0?0:b;
  return '#'+(r<<16|g<<8|b).toString(16).padStart(6,'0');
}

function edgesClose(p1,p2,q1,q2,dist,lenTol){
  const l1=distance(p1,p2); const l2=distance(q1,q2);
  if(Math.abs(l1-l2)>lenTol) return false;
  const m1=midpoint(p1,p2); const m2=midpoint(q1,q2);
  return distance(m1,m2)<dist;
}

function checkInteractions(){
  for(let t of triangles) t.highlight=0;
  for(let i=0;i<triangles.length;i++){
    for(let j=i+1;j<triangles.length;j++){
      const a=triangles[i], b=triangles[j];
      for(let ai=0;ai<3;ai++){
        for(let aj=0;aj<3;aj++){
          const a1=a.points[ai]; const a2=a.points[(ai+1)%3];
          const b1=b.points[aj]; const b2=b.points[(aj+1)%3];
          const d=edgesClose(a1,a2,b1,b2,snapDistance*2,20);
          if(d){
            const closeness=distance(midpoint(a1,a2),midpoint(b1,b2));
            const glow=1-(closeness/(snapDistance*2));
            a.highlight=Math.max(a.highlight,glow);
            b.highlight=Math.max(b.highlight,glow);
          }
          if(edgesClose(a1,a2,b1,b2,snapDistance,10)){
            if(a.isSuper||b.isSuper){
              shatter(a.isSuper?a:b, a.isSuper?b:a);
              return;
            }else{
              merge(a,b,ai,aj);
              return;
            }
          }
        }
      }
    }
  }
}

function merge(t1,t2,i1,i2){
  const other1=t1.points[(i1+2)%3];
  const other2=t2.points[(i2+2)%3];
  const m1=midpoint(t1.points[i1],t1.points[(i1+1)%3]);
  const m2=midpoint(t2.points[i2],t2.points[(i2+1)%3]);
  const center=midpoint(m1,m2);
  const newTri={
    points:[clonePoint(other1), clonePoint(other2), {x:center.x,y:center.y,dx:0,dy:0}],
    color:Math.random()<0.5?colorsA:colorsB,
    isSuper:true,
    highlight:0,
    phase:Math.random()*Math.PI*2
  };
  triangles=triangles.filter(t=>t!==t1&&t!==t2);
  triangles.push(newTri);
}

function shatter(superTri, tri){
  const verts=[...superTri.points,...tri.points];
  triangles=triangles.filter(t=>t!==superTri&&t!==tri);
  verts.forEach(v=>{
    for(let k=0;k<2;k++){
      const p1=clonePoint(v);
      const p2=clonePoint(v);
      p1.x+=rand(-20,20); p1.y+=rand(-20,20);
      p2.x+=rand(-20,20); p2.y+=rand(-20,20);
      p1.dx=rand(-2,2); p1.dy=rand(-2,2);
      p2.dx=rand(-2,2); p2.dy=rand(-2,2);
      const triNew={
        points:[clonePoint(v),p1,p2],
        color:Math.random()<0.5?colorsA:colorsB,
        isSuper:false,
        highlight:0,
        phase:Math.random()*Math.PI*2
      };
      triangles.push(triNew);
    }
  });
}

function draw(){
  ctx.clearRect(0,0,width,height);
  const time=Date.now()/1000;
  triangles.forEach(t=>{
    ctx.beginPath();
    ctx.moveTo(t.points[0].x,t.points[0].y);
    ctx.lineTo(t.points[1].x,t.points[1].y);
    ctx.lineTo(t.points[2].x,t.points[2].y);
    ctx.closePath();
    const pulse=(Math.sin(time*2+t.phase)+1)/2;
    ctx.lineWidth=2+pulse*2;
    ctx.shadowBlur=10+pulse*10;
    ctx.shadowColor=lighten(t.color[0],80);
    const base=t.color[0];
    const fill=t.highlight?lighten(base,Math.floor(t.highlight*120)):base;
    ctx.fillStyle=fill;
    ctx.strokeStyle=lighten(base,100);
    ctx.fill();
    ctx.stroke();
    ctx.shadowBlur=0;
  });
}

function loop(){
  movePoints();
  checkInteractions();
  draw();
  requestAnimationFrame(loop);
}

resetTriangles(5);
loop();

// Controls
const settings=document.getElementById('settings');
const toggleBtn=document.getElementById('toggleSettings');
const countInput=document.getElementById('triCount');
const snapInput=document.getElementById('snapRange');

toggleBtn.addEventListener('click',()=>{ settings.style.display=settings.style.display==='none'?'block':'none';});
countInput.addEventListener('input',()=>{ resetTriangles(parseInt(countInput.value,10)); });
snapInput.addEventListener('input',()=>{ snapDistance=parseInt(snapInput.value,10); });
</script>
</body>
</html>
